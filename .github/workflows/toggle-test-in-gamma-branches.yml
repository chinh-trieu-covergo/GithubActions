name: Enable test in gamma branches
on:
  workflow_dispatch
jobs:
  toggle-test-in-gamma-branches:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    strategy:
      matrix:
        repository:
          - chinh-trieu-covergo/Reference
          - chinh-trieu-covergo/RequestManager
          - chinh-trieu-covergo/quotation
          - chinh-trieu-covergo/Products
          - chinh-trieu-covergo/Premium
          - chinh-trieu-covergo/Pricing
          - chinh-trieu-covergo/Policies
          - chinh-trieu-covergo/Notifications
          - chinh-trieu-covergo/FileSystem
          - chinh-trieu-covergo/Education
          - chinh-trieu-covergo/EntityDiary
          - chinh-trieu-covergo/EntityManagement
          - chinh-trieu-covergo/Finance
          - chinh-trieu-covergo/ProductBuilder
          - chinh-trieu-covergo/Templates
          - chinh-trieu-covergo/Transactions
          - chinh-trieu-covergo/Users
          - chinh-trieu-covergo/Scheduler
          - chinh-trieu-covergo/Scripts-js
          - chinh-trieu-covergo/Achievements
          - chinh-trieu-covergo/api-gateway
          - chinh-trieu-covergo/Auth
          - chinh-trieu-covergo/Cases
          - chinh-trieu-covergo/ClaimInvestigation
          - chinh-trieu-covergo/Claims
          - chinh-trieu-covergo/ChannelManagement
          - chinh-trieu-covergo/Claims3
    steps:     
      - name: Enable test in gamma branches for ${{ matrix.repository }}
        env:
          token: ${{ secrets.REPO_ACCESS_TOKEN || secrets.GITHUB_TOKEN }}
          GH_TOKEN: ${{ secrets.REPO_ACCESS_TOKEN || secrets.GITHUB_TOKEN }}
          SKIP: ${{ vars.SKIP_GAMMA_TEST }}
        run: |
            REPO="${{ matrix.repository }}"
            echo "Repository from matrix: $REPO"
            echo "current SKIP_GAMMA_TEST: $SKIP"
            # If you want to verify via github CLI (gh), you can fetch repository details like this:            
            SKIP_GAMMA_TEST=$(gh variable get SKIP_GAMMA_TEST --repo "$REPO" 2>/dev/null | awk -F': ' '/SKIP_GAMMA_TEST/ {print $2}')
            echo "SKIP_GAMMA_TEST value: $SKIP_GAMMA_TEST"
            if [[ -z "$SKIP_GAMMA_TEST" ]]; then
              echo "SKIP_GAMMA_TEST not found, creating it with value=true"
              gh variable set SKIP_GAMMA_TEST --body "true" --repo "$REPO"
              SKIP_GAMMA_TEST="true"
            fi
            if [[ "$SKIP_GAMMA_TEST" == "true" ]]; then
              gh variable set SKIP_GAMMA_TEST --body "false" --repo "$REPO"
              echo "Toggled SKIP_GAMMA_TEST to false"
            elif [[ "$SKIP_GAMMA_TEST" == "false" ]]; then
              gh variable set SKIP_GAMMA_TEST --body "true" --repo "$REPO"
              echo "Toggled SKIP_GAMMA_TEST to true"
            else
              echo "SKIP_GAMMA_TEST variable not found or not set to true/false. Skipping toggle."
            fi
        
