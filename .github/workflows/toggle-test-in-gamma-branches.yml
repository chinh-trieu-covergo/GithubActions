name: Enable test in gamma branches
on:
  workflow_dispatch
jobs:
  toggle-test-in-gamma-branches:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    strategy:
      matrix:
        repository:
          - chinh-trieu-covergo/Reference
          - chinh-trieu-covergo/RequestManager
          - chinh-trieu-covergo/quotation
          - chinh-trieu-covergo/Products
          - chinh-trieu-covergo/Premium
          - chinh-trieu-covergo/Pricing
          - chinh-trieu-covergo/Policies
          - chinh-trieu-covergo/Notifications
          - chinh-trieu-covergo/FileSystem
          - chinh-trieu-covergo/Education
          - chinh-trieu-covergo/EntityDiary
          - chinh-trieu-covergo/EntityManagement
          - chinh-trieu-covergo/Finance
          - chinh-trieu-covergo/ProductBuilder
          - chinh-trieu-covergo/Templates
          - chinh-trieu-covergo/Transactions
          - chinh-trieu-covergo/Users
          - chinh-trieu-covergo/Scheduler
          - chinh-trieu-covergo/Scripts-js
          - chinh-trieu-covergo/Achievements
          - chinh-trieu-covergo/api-gateway
          - chinh-trieu-covergo/Auth
          - chinh-trieu-covergo/Cases
          - chinh-trieu-covergo/ClaimInvestigation
          - chinh-trieu-covergo/Claims
          - chinh-trieu-covergo/ChannelManagement
          - chinh-trieu-covergo/Claims3
    steps:
      - name: Enable test in gamma branches for ${{ matrix.repository }}       
        run: |         
          # Print out and toggle the SKIP_GAMMA_TEST variable using vars context
          echo "${{ matrix.repository }}"
          echo "Current SKIP_GAMMA_TEST value: ${{ vars.SKIP_GAMMA_TEST }}"
          if [[ "${{ vars.SKIP_GAMMA_TEST }}" == "true" ]]; then
            echo "Toggled SKIP_GAMMA_TEST to false"
            # Set the new value via GitHub CLI (requires workflow token with repo or actions:write scope)
            gh variable set SKIP_GAMMA_TEST --body "false" --repo "${{ github.repository }}"
          elif [[ "${{ vars.SKIP_GAMMA_TEST }}" == "false" ]]; then
            echo "Toggled SKIP_GAMMA_TEST to true"
            gh variable set SKIP_GAMMA_TEST --body "true" --repo "${{ github.repository }}"
          else
            echo "SKIP_GAMMA_TEST variable not found or not set to true/false. Skipping toggle."
          fi
        
